<!DOCTYPE html>
<html>
<head>
  <title>Peserta Absensi</title>
  <script src="https://meet.jit.si/external_api.js"></script>
  <script src="face-api.min.js"></script>
  <script src="firebase-config.js"></script>
</head>

<body>
<h2>Peserta</h2>
<video id="video" width="320" autoplay muted></video>
<p id="status">Menunggu wajah...</p>

<script>
const nama = prompt("Masukkan nama:");
const room = "AbsensiJitsi2026";

const video = document.getElementById("video");

Promise.all([
  faceapi.nets.tinyFaceDetector.loadFromUri('./models')
]).then(startVideo);

function startVideo() {
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => video.srcObject = stream);
}

video.addEventListener('play', () => {
  setInterval(async () => {
    const detection = await faceapi.detectSingleFace(
      video,
      new faceapi.TinyFaceDetectorOptions()
    );

    if (detection) {
      document.getElementById("status").innerText = "Wajah terdeteksi âœ…";

      const data = {
        nama: nama,
        waktu: new Date().toLocaleString(),
        status: "hadir"
      };

      firebase.database().ref("absensi/" + nama).set(data);
    }
  }, 3000);
});

// Jitsi
new JitsiMeetExternalAPI("meet.jit.si", {
  roomName: room,
  parentNode: document.body,
  userInfo: { displayName: nama }
});
</script>
</body>
</html>
